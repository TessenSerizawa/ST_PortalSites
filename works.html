<!DOCTYPE html>
<html class="no-js" lang="ja">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio Site - WORKS</title>
    <meta name="description" content="Explore my portfolio of 3D models, projects, and creative works.">
    
    <!-- フォント -->
    <link href="https://fonts.googleapis.com/css?family=Oswald:400,700|Ubuntu+Condensed|Noto+Sans+JP:400,700" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/gh/sygnas/font-icomoon@1.2.0/style.css" rel="stylesheet">
    
    <!-- CSS -->
    <link rel="stylesheet" href="css/style.css">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://yourusername.github.io/your-repository/works.html">
    <meta property="og:title" content="Portfolio Site - WORKS">
    <meta property="og:description" content="Explore my portfolio of 3D models, projects, and creative works.">
    <meta property="og:image" content="https://yourusername.github.io/your-repository/images/og-image.jpg">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://yourusername.github.io/your-repository/works.html">
    <meta property="twitter:title" content="Portfolio Site - WORKS">
    <meta property="twitter:description" content="Explore my portfolio of 3D models, projects, and creative works.">
    <meta property="twitter:image" content="https://yourusername.github.io/your-repository/images/og-image.jpg">
    
    <style>
        /* WORKS専用のスタイル */
        .works-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 30px;
        }
        
        .work-item {
            background: #fff;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .work-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
        }
        
        .work-image {
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, #f0f0f0 0%, #e0e0e0 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            font-size: 14px;
            position: relative;
            overflow: hidden;
        }
        
        .work-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            image-rendering: -webkit-optimize-contrast;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
            image-rendering: auto;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            filter: contrast(1.1) brightness(1.05);
        }
        
        .work-content {
            padding: 25px;
        }
        
        .work-title {
            font-family: 'Oswald', sans-serif;
            font-size: 20px;
            color: #333;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .work-description {
            font-size: 14px;
            color: #666;
            line-height: 1.6;
            margin-bottom: 15px;
        }
        
        .work-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .work-tag {
            padding: 4px 12px;
            background: #f0f0f0;
            color: #666;
            font-size: 12px;
            border-radius: 12px;
            font-weight: 600;
        }
        
        .work-tag--3d {
            background: #e3f2fd;
            color: #1976d2;
        }
        
        .work-tag--blender {
            background: #fff3e0;
            color: #f57c00;
        }
        
        .work-tag--unity {
            background: #e8f5e8;
            color: #388e3c;
        }
        
        .work-tag--web {
            background: #fce4ec;
            color: #c2185b;
        }
        
        /* カテゴリフィルター */
        .works-filter {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 10px 20px;
            background: #f5f5f5;
            color: #666;
            border: none;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }
        
        .filter-btn:hover,
        .filter-btn.active {
            background: #333;
            color: #fff;
        }
        
        /* ローディング・エラー・空状態 */
        .loading-state, .error-state, .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }
        
        .loading-state .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #333;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error-state {
            color: #e74c3c;
        }
        
        .error-state button {
            padding: 10px 20px;
            background: #333;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s ease;
            margin-top: 15px;
        }
        
        .error-state button:hover {
            background: #555;
        }
        
        @media (max-width: 768px) {
            .works-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .works-filter {
                flex-direction: column;
                align-items: center;
                gap: 10px;
            }
            
            .filter-btn {
                width: 200px;
            }
        }
    </style>
</head>
<body id="page-works" class="l-body-fit">

<header class="l-header l-header--works">
    <h1 class="l-header__logo">
        <a href="index.html">SITE LOGO</a>
    </h1>

    <nav class="c-mainmenu c-mainmenu--header c-mainmenu--works">
        <ul style="display: contents;">
            <li class="c-mainmenu__item c-mainmenu__item--home">
                <a href="index.html" class="c-mainmenu__link">HOME</a>
            </li>
            <li class="c-mainmenu__item c-mainmenu__item--progress">
                <a href="progress.html" class="c-mainmenu__link">PROGRESS</a>
            </li>
            <li class="c-mainmenu__item c-mainmenu__item--introduction">
                <a href="introduction.html" class="c-mainmenu__link">INTRODUCTION</a>
            </li>
            <li class="c-mainmenu__item c-mainmenu__item--works">
                <a href="works.html" class="c-mainmenu__link active">WORKS</a>
            </li>
            <li class="c-mainmenu__item c-mainmenu__item--link">
                <a href="link.html" class="c-mainmenu__link">LINK</a>
            </li>
        </ul>
    </nav>
</header>

<!--ハンバーガーメニュー-->
<button class="p-hamburger" type="button" aria-label="メニュー">
    <span class="p-hamburger__line"></span>
    <span class="p-hamburger__line"></span>
    <span class="p-hamburger__line"></span>
</button>

<main class="l-wrapper l-wrapper--works">
    <div class="page-content">
        <div class="link-section">
            <h2>WORKS</h2>
            
            <!-- フィルターボタン -->
            <div class="works-filter" id="works-filter">
                <button class="filter-btn active" data-filter="all">All</button>
                <!-- タグは動的に追加されます -->
            </div>
            
            <!-- 作品グリッド -->
            <div class="works-grid" id="works-grid">
                <!-- 作品は動的に追加されます -->
                <div class="loading-state" id="works-loading">
                    <div class="spinner"></div>
                    <div style="font-size: 18px; margin-top: 15px;">作品を読み込み中...</div>
                </div>
            </div>
            
            <!-- 空状態 -->
            <div class="empty-state" id="works-empty" style="display: none;">
                <h3>該当する作品がありません</h3>
                <p>選択されたタグには作品がありません。</p>
            </div>
            
            <!-- エラー状態 -->
            <div class="error-state" id="works-error" style="display: none;">
                <h3>作品の読み込みに失敗しました</h3>
                <p>GitHubリポジトリから作品データを取得できませんでした。</p>
                <button onclick="loadWorksData()">再試行</button>
            </div>
        </div>
    </div>
</main>

<footer class="l-footer">
    <p>©2025 Portfolio Site. All rights reserved.</p>
</footer>

<script src="js/script.js"></script>
<script>
// WORKS専用のフィルタリング機能
document.addEventListener('DOMContentLoaded', function() {
    initPage('works');
    loadWorksData();
});

// 作品データとフィルター状態
let allWorks = [];
let allTags = new Set();
let currentFilter = 'all';

// GitHub設定
const WORKS_CONFIG = {
    owner: 'TessenSerizawa',
    repo: 'ST_PortalSites', 
    branch: 'master',
    worksPath: '_works',
    imagesPath: 'assets/images/works'
};

// 作品データを読み込む
async function loadWorksData() {
    const loadingState = document.getElementById('works-loading');
    const worksGrid = document.getElementById('works-grid');
    const errorState = document.getElementById('works-error');
    
    try {
        // ローディング表示
        if (loadingState) loadingState.style.display = 'block';
        if (errorState) errorState.style.display = 'none';
        
        console.log('作品データを読み込み中...');
        
        // 複数の方法で作品ファイルを取得
        let works = [];
        
        try {
            works = await loadWorksFromGitHub();
            console.log('GitHub APIから作品を取得:', works.length, '件');
        } catch (apiError) {
            console.warn('GitHub API取得に失敗:', apiError);
            works = getSampleWorks();
            console.log('サンプル作品データを使用:', works.length, '件');
        }
        
        if (works.length === 0) {
            throw new Error('作品データが見つかりませんでした');
        }
        
        allWorks = works;
        
        // タグを収集
        works.forEach(work => {
            if (work.tags && Array.isArray(work.tags)) {
                work.tags.forEach(tag => allTags.add(tag));
            }
        });
        
        // フィルターボタンを更新
        updateFilterButtons();
        
        // 作品を表示
        displayWorks(allWorks);
        
    } catch (error) {
        console.error('作品データの読み込みに失敗:', error);
        showWorksError(error);
    } finally {
        if (loadingState) loadingState.style.display = 'none';
    }
}

// GitHub APIから作品を取得
async function loadWorksFromGitHub() {
    const apiUrl = `https://api.github.com/repos/${WORKS_CONFIG.owner}/${WORKS_CONFIG.repo}/contents/${WORKS_CONFIG.worksPath}?ref=${WORKS_CONFIG.branch}`;
    
    const response = await fetch(apiUrl);
    
    if (!response.ok) {
        throw new Error(`GitHub API エラー: ${response.status}`);
    }
    
    const files = await response.json();
    const markdownFiles = files.filter(file => 
        file.type === 'file' && file.name.endsWith('.md')
    );
    
    const works = await Promise.all(
        markdownFiles.map(async (file) => {
            try {
                const content = await fetch(file.download_url).then(r => r.text());
                return parseWorkFile(file.name, content);
            } catch (error) {
                console.error(`Error loading ${file.name}:`, error);
                return null;
            }
        })
    );
    
    return works.filter(work => work !== null);
}

// 作品ファイルを解析
function parseWorkFile(filename, content) {
    const lines = content.split('\n');
    let frontMatterEnd = -1;
    
    // フロントマターの解析
    if (lines[0] === '---') {
        for (let i = 1; i < lines.length; i++) {
            if (lines[i] === '---') {
                frontMatterEnd = i;
                break;
            }
        }
    }
    
    let work = {
        title: filename.replace('.md', ''),
        description: '',
        image: '',
        tags: [],
        category: '',
        link: '',
        date: new Date()
    };
    
    if (frontMatterEnd > 0) {
        const frontMatter = lines.slice(1, frontMatterEnd);
        
        frontMatter.forEach(line => {
            const colonIndex = line.indexOf(':');
            if (colonIndex === -1) return;
            
            const key = line.substring(0, colonIndex).trim();
            const value = line.substring(colonIndex + 1).trim().replace(/^["']|["']$/g, '');
            
            switch (key) {
                case 'title':
                    work.title = value;
                    break;
                case 'description':
                    work.description = value;
                    break;
                case 'image':
                    work.image = value;
                    break;
                case 'tags':
                    // 配列形式とカンマ区切り文字列の両方に対応
                    if (value.startsWith('[') && value.endsWith(']')) {
                        work.tags = JSON.parse(value);
                    } else {
                        work.tags = value.split(',').map(tag => tag.trim());
                    }
                    break;
                case 'category':
                    work.category = value;
                    break;
                case 'link':
                    work.link = value;
                    break;
                case 'date':
                    work.date = new Date(value);
                    break;
            }
        });
    }
    
    // 本文を取得
    const body = lines.slice(frontMatterEnd + 1).join('\n');
    if (!work.description && body) {
        work.description = body.substring(0, 150) + '...';
    }
    
    return work;
}

// サンプル作品データ
function getSampleWorks() {
    return [
        {
            title: 'キャラクターモデル Vol.1',
            description: 'Blenderで制作したオリジナルキャラクターの3Dモデルです。リギング、テクスチャリングまで完了しており、VRChatやUnityで使用可能です。',
            image: '',
            tags: ['3D', 'Blender', 'Character'],
            category: '3d',
            link: '',
            date: new Date(2025, 6, 1)
        },
        {
            title: 'ポートフォリオサイト',
            description: 'レスポンシブデザインに対応したポートフォリオサイト。モダンなUIとスムーズなアニメーションが特徴です。',
            image: '',
            tags: ['Web', 'HTML', 'CSS', 'JavaScript'],
            category: 'web',
            link: '',
            date: new Date(2025, 5, 15)
        },
        {
            title: 'VR体験コンテンツ',
            description: 'VR空間での没入型体験コンテンツ。自然環境をテーマにしたリラクゼーション空間を提供します。',
            image: '',
            tags: ['VR', 'Unity', '3D', 'Environment'],
            category: 'game',
            link: '',
            date: new Date(2025, 4, 20)
        }
    ];
}

// フィルターボタンを更新
function updateFilterButtons() {
    const worksFilter = document.getElementById('works-filter');
    if (!worksFilter) return;
    
    // 既存のボタンをクリア（Allボタン以外）
    const allButton = worksFilter.querySelector('.filter-btn[data-filter="all"]');
    worksFilter.innerHTML = '';
    worksFilter.appendChild(allButton);
    
    // タグボタンを追加
    Array.from(allTags).sort().forEach(tag => {
        const button = document.createElement('button');
        button.className = 'filter-btn';
        button.setAttribute('data-filter', tag.toLowerCase());
        button.textContent = tag;
        
        button.addEventListener('click', function() {
            setActiveFilter(this);
            filterWorks(tag.toLowerCase());
        });
        
        worksFilter.appendChild(button);
    });
    
    // Allボタンのイベントリスナーを再設定
    allButton.addEventListener('click', function() {
        setActiveFilter(this);
        filterWorks('all');
    });
}

// 作品を表示
function displayWorks(works) {
    const worksGrid = document.getElementById('works-grid');
    const loadingState = document.getElementById('works-loading');
    const emptyState = document.getElementById('works-empty');
    
    if (!worksGrid) return;
    
    if (loadingState) loadingState.style.display = 'none';
    
    if (works.length === 0) {
        if (emptyState) emptyState.style.display = 'block';
        return;
    }
    
    if (emptyState) emptyState.style.display = 'none';
    
    // 既存のコンテンツをクリア
    worksGrid.innerHTML = '';
    
    works.forEach(work => {
        const workItem = document.createElement('div');
        workItem.className = 'work-item';
        workItem.setAttribute('data-category', work.category);
        workItem.setAttribute('data-tags', work.tags.join(',').toLowerCase());
        
        // 画像パスを適切に変換
        const imageHtml = work.image ? 
            `<img src="${convertWorkImagePath(work.image)}" alt="${work.title}" />` :
            `<span>${work.category || '作品'}画像</span>`;
        
        const tagsHtml = work.tags.map(tag => {
            const tagClass = getTagClass(tag);
            return `<span class="work-tag ${tagClass}">${tag}</span>`;
        }).join('');
        
        workItem.innerHTML = `
            <div class="work-image">
                ${imageHtml}
            </div>
            <div class="work-content">
                <h3 class="work-title">${work.title}</h3>
                <p class="work-description">${work.description}</p>
                <div class="work-tags">
                    ${tagsHtml}
                </div>
            </div>
        `;
        
        if (work.link) {
            workItem.addEventListener('click', () => {
                window.open(work.link, '_blank');
            });
            workItem.style.cursor = 'pointer';
        }
        
        worksGrid.appendChild(workItem);
    });
}

// 作品画像パスを変換
function convertWorkImagePath(imagePath) {
    if (imagePath.startsWith('http://') || imagePath.startsWith('https://')) {
        return imagePath;
    }
    
    // 相対パスの場合、GitHubのrawコンテンツURLに変換
    const baseUrl = `https://raw.githubusercontent.com/${WORKS_CONFIG.owner}/${WORKS_CONFIG.repo}/${WORKS_CONFIG.branch}`;
    
    if (imagePath.startsWith('assets/') || imagePath.startsWith('./assets/')) {
        return `${baseUrl}/${imagePath.replace(/^\.\//, '')}`;
    }
    
    return `${baseUrl}/${imagePath}`;
}

// タグに応じたCSSクラスを取得
function getTagClass(tag) {
    const tagLower = tag.toLowerCase();
    if (['3d', 'character', 'model'].includes(tagLower)) return 'work-tag--3d';
    if (['blender', 'maya', 'max'].includes(tagLower)) return 'work-tag--blender';
    if (['unity', 'unreal', 'game', 'vr'].includes(tagLower)) return 'work-tag--unity';
    if (['web', 'html', 'css', 'javascript'].includes(tagLower)) return 'work-tag--web';
    return '';
}

// フィルター機能
function setActiveFilter(activeButton) {
    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    activeButton.classList.add('active');
}

function filterWorks(filter) {
    currentFilter = filter;
    
    if (filter === 'all') {
        displayWorks(allWorks);
    } else {
        const filteredWorks = allWorks.filter(work => 
            work.tags.some(tag => tag.toLowerCase() === filter)
        );
        displayWorks(filteredWorks);
    }
}

// エラー表示
function showWorksError(error) {
    const errorState = document.getElementById('works-error');
    const loadingState = document.getElementById('works-loading');
    
    if (loadingState) loadingState.style.display = 'none';
    if (errorState) errorState.style.display = 'block';
}

// グローバル関数として公開
window.loadWorksData = loadWorksData;
</script>

</body>
</html>
